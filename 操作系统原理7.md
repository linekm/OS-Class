### 操作系统原理

#### 进程
**进程**是程序在某个数据集合上的一次运行活动

##### 特征
- 动态性
    - 进程是程序的一次执行过程，动态产生/消亡
- 并发性
  - 进程同其他进程一起向前推进 
- **异步性**
  - 进程按各自速度向前推进 
- 独立性
    - 进程是系统分配资源和调度CPU的单位

##### 运行状态
- 运行状态（Running）
  - 进程已经占有CPU，在CPU上运行 
- 就绪状态（Ready）
  - 具备运行条件但由于无CPU，暂时不能运行
- 阻塞状态（Block）
  - 因为等待某项服务完成或信号来到而不能运行的状态
    例如等待：系统调用，I/O操作，合作进程的服务或信号…

![屏幕快照 2019-03-15 10.17.47.png-173.7kB][1]

##### 挂起(suspend)和解挂(resume ，激活activate)
**挂起**：用户或OS将进程有意暂停；
**解挂**：将挂起的进程继续。
阻塞：**静止阻塞**（阻塞时挂起）和**活跃阻塞**（正常阻塞）；
就绪：**静止就绪**（就绪时挂起）和**活跃就绪**（正常就绪）。

**E.g:**
运行  to  静止就绪：挂起
活跃就绪  to  静止就绪：挂起
活跃阻塞  to  静止阻塞：挂起
静止就绪  to  活跃就绪：解挂
静止阻塞  to  动活跃阻塞：解挂
静止阻塞  to  静止就绪：期待的事件/信号发生

![屏幕快照 2019-03-15 10.26.33.png-299.9kB][2]

##### Linux进程状态

**就绪**：*TASK_RUNNING*

**阻塞**：

**浅度阻塞**：TASK_INTERRUPTIBLE（可中断）
可被其他进程的信号或时钟中断唤醒。
**深度阻塞**：TASK_UNINTERRUPTIBLE（不可中断）
不能被其他进程通过信号和时钟中断唤醒。

**僵死态**：
TASK_ZOMBIE
进程终止执行，释放大部分资源

**挂起态**：
TASK_STOPPED
进程被挂起。

##### 进程管理块（PCB）

描述进程的状态、资源、和相关进程的关系的一种**数据结构**。
PCB是**进程的标志**
创建进程时创建PCB；进程撤销后PCB同时撤销。（生命周期相同）

**进程 ＝ 程序 ＋ PCB**

![屏幕快照 2019-03-15 10.44.56.png-308.7kB][3]

##### 进程切换过程
![屏幕快照 2019-03-15 11.26.11.png-688kB][4]


#### 进程控制
**概念**
在进程生存全期间，对其全部行为的控制

**四个典型的控制行为**
- 创建进程
- 撤消进程
- 阻塞进程
- 唤醒进程

##### 进程创建
 - 创建一个空白PCB
 - 获得并赋予进程标识符ID
 - 为进程分配空间
 - 初始化PCB
    - 默认值
 - 插入相应的进程队列
 - 新进程插入就绪队列

进程创建伪代码
```c
Create (Si,Mi,Pi)   // CPU的状态,内存,优先级
{
    p = Get_New_PCB(  );         //分配新的PCB
    pid = Get_New_PID(  );       //分配进程的PID
    p->ID = pid;                       //设置进程的PID
    p->CPU_State = Si;           //CPU的状态
    p->Memory = Mi;              //内存
    p->Priority = Pi;                  //优先级
    p->Status.Type = "Ready";  //进程状态
    p->Status.Lis t = RL;            //进程队列RL：Ready List
   ……………………
    Insert(RL,  p);                     //将进程p插入就绪队列
    Scheduler(  );                      //调度程序                         
}

```

##### 进程撤销
**功能**
 - 撤消一个指定的进程
 - 收回进程所占有的资源，撤消该进程的PCB

**进程撤销的时机/事件**
 - 正常结束
 - 异常结束
 - 外界干预

**参数**
 - 被撤消的进程名（ID）

**进程撤销的实现**
 - 在PCB队列中检索出该PCB
 - 获取该进程的状态。
 - 若该进程处在运行态，立即终止该进程。
    - 【递归】检查是否有子进程，**先“撤销”子进程**。
 - 释放进程占有的资源
 - 将进程从PCB队列中移除

##### 进程阻塞
**功能**
停止进程的执行，变为阻塞。

**阻塞的时机/事件**
 - 请求系统服务(由于某种原因，OS不能立即满足进程的要求）
 - 启动某种操作（进程启动某操作，阻塞等待该操作完成）
 - 新数据尚未到达（A进程要获得B进程的中间结果，A进程等待）
 - 无新工作可作（进程完成任务后，自我阻塞，等待新任务到达）







[1]: http://static.zybuluo.com/linekm/styhqk6blj8o49q8uvigq44u/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-03-15%2010.17.47.png
[2]: http://static.zybuluo.com/linekm/2uconjg5v0s3wbe6j1y4eakp/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-03-15%2010.26.33.png
[3]: http://static.zybuluo.com/linekm/69g0gbzeviys3yd0dn49lnkr/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-03-15%2010.44.56.png
[4]: http://static.zybuluo.com/linekm/438up3xw903q6wg2mrdftacu/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-03-15%2011.26.11.png
